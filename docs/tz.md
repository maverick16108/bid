Техническое задание

Сервис сбора заявок холдинга «Новосталь-М»

⸻

1. Общая информация

1.1 Назначение системы

Веб-сервис для клиентов холдинга «Новосталь-М», предназначенный для:
	•	регистрации клиентов после заключения договора,
	•	создания и отправки заявок разных типов,
	•	двустороннего обмена данными с системой 1С,
	•	отображения статусов и истории обработки заявок.

Обработка заявок и формирование спецификаций осуществляется в системе 1С. Веб-сервис выступает как клиентский интерфейс и точка интеграции.

⸻

2. Технологический стек
	•	Backend: Laravel 11
	•	Frontend: Vue 3 (SPA)
	•	База данных: PostgreSQL
	•	Архитектура: монорепозиторий
	•	Интеграция с 1С: HTTP-сервисы (REST, JSON)
	•	Авторизация: OTP по SMS
	•	Язык интерфейса: русский

⸻

3. Структура проекта (обязательное требование)

Проект должен быть реализован в одном репозитории, при этом фронтенд и бэкенд должны быть логически и физически разделены.

Рекомендуемая структура:

/novostal-m/
 ├─ backend/        (Laravel API)
 ├─ frontend/       (Vue SPA)
 ├─ assets/
 │   └─ logo/       (логотип Новосталь-М — прилагается)
 ├─ docs/
 └─ README.md

Требование: ИИ-ассистент (Gemini CLI) должен иметь возможность работать сразу с фронтом и бэком в одном проекте.

⸻

4. Окружение и публикация
	•	Сервер: Debian
	•	Домен bid.prema.su припаркован к корневой директории проекта
	•	Web-сервер: nginx
	•	nginx используется:
	•	как web-сервер для frontend (Vue SPA)
	•	как reverse-proxy для backend (Laravel API)
	•	Backend доступен как API (рекомендуемо через /api)
	•	Frontend — SPA, nginx должен делать fallback на index.html

⸻

5. Роли и права доступа

5.1 Роли
	•	Гость
	•	Клиент
	•	Модератор
	•	Администратор

5.2 Права

Гость
	•	оставить номер телефона для заключения договора.

Клиент
	•	вход по SMS,
	•	создание заявок,
	•	просмотр только своих заявок,
	•	просмотр статусов и истории.

Модератор / Администратор
	•	активация клиентов после договора,
	•	просмотр всех заявок,
	•	контроль интеграции с 1С,
	•	просмотр логов обмена.

⸻

6. Авторизация и регистрация

6.1 Первый контакт
	•	Гость вводит номер телефона.
	•	Система фиксирует обращение.
	•	Пользователю отображается сообщение:
«Спасибо! Менеджер свяжется с вами для заключения договора».

6.2 Активация клиента

После заключения договора:
	•	модератор/администратор создаёт или активирует клиента,
	•	указывает ИНН организации, email и телефон,
	•	выполняет привязку клиента к контрагенту в 1С (при наличии данных).

6.3 Вход в систему
	•	вход осуществляется только по номеру телефона,
	•	подтверждение — одноразовый код по SMS,
	•	применяются ограничения по частоте и количеству попыток.

⸻

7. Заявки

7.1 Типы заявок (на старте)
	1.	Заявка на заказ арматуры
	2.	Заявка на заказ транспорта

Архитектура системы должна позволять добавлять новые типы заявок без переработки ядра.

⸻

8. Статусы заявок
	•	Статусы жёстко зашиты в системе.
	•	Пользователь не может изменять статусы.
	•	Администратор не может редактировать или добавлять статусы через интерфейс.
	•	Основным источником статуса является система 1С.

Примеры статусов:
	•	отправлена
	•	принята в 1С
	•	в обработке
	•	требуется уточнение
	•	выполнена
	•	отклонена

⸻

9. Заявка на арматуру (ключевая бизнес-логика)

9.1 Спецификации
	•	Все спецификации арматуры ведутся в 1С.
	•	Для каждой организации существует набор согласованных позиций арматуры.
	•	Сервис получает спецификации из 1С по HTTP-сервисам.

9.2 Ограничение выбора
	•	Клиент может выбрать только те позиции арматуры, которые:
	•	относятся к его организации,
	•	присутствуют в согласованных спецификациях из 1С.
	•	Произвольный ввод арматуры запрещён.

9.3 Отправка в 1С
	•	При создании заявки сервис передаёт в 1С:
	•	выбранные позиции (с идентификаторами 1С),
	•	количество,
	•	параметры доставки и комментарии.

⸻

10. Заявка на транспорт
	•	Форма заявки содержит параметры перевозки (тип транспорта, адреса, даты и т.п.).
	•	Все данные заявки передаются в 1С.
	•	Статус и дальнейшая обработка управляются в 1С.

⸻

11. Интеграция с 1С

11.1 Общие требования
	•	Двусторонний обмен по HTTP (REST, JSON).
	•	Все входящие запросы из 1С должны быть защищены.
	•	Каждая сущность, участвующая в обмене, должна иметь идентификатор 1С.

11.2 Направления обмена

Сервис → 1С
	•	передача созданных заявок,
	•	повторная отправка при ошибках.

1С → Сервис
	•	обновление статусов заявок,
	•	передача комментариев,
	•	передача спецификаций арматуры.

11.3 Логирование
	•	Все запросы и ответы интеграции должны логироваться (дата, направление, результат).

⸻

12. Личный кабинет клиента

Разделы:
	•	дашборд,
	•	список заявок,
	•	карточка заявки,
	•	создание заявки,
	•	профиль.

Функции:
	•	фильтрация и поиск заявок,
	•	просмотр истории статусов,
	•	отображение комментариев из 1С.

⸻

13. Административная часть

Функциональность:
	•	список обращений (лидов),
	•	активация клиентов,
	•	просмотр всех заявок,
	•	мониторинг обмена с 1С,
	•	просмотр ошибок интеграции.

⸻

14. UI / UX требования
	•	современный минималистичный дизайн,
	•	аккуратные анимации и переходы,
	•	micro-interaction,
	•	skeleton-загрузки,
	•	адаптивность.

⸻

15. Логотип
	•	Логотип «Новосталь-М» предоставляется заказчиком.
	•	Файл размещается в папке:

/assets/logo/


⸻

16. Критерии готовности MVP
	1.	Гость может оставить телефон.
	2.	Клиент активируется администратором.
	3.	Клиент входит по SMS.
	4.	Клиент создаёт заявки двух типов.
	5.	В заявке на арматуру доступны только согласованные позиции из 1С.
	6.	Заявки передаются в 1С.
	7.	Статусы и комментарии обновляются из 1С.
	8.	Клиент видит актуальное состояние заявок.
	9.	Фронт и бэк находятся в одном проекте, но разделены по папкам.
	10.	Используется PostgreSQL (никаких MySQL-специфичных решений).